---
import { useTranslations, getLocalizedPath } from '../i18n/utils';

interface Props {
  lang?: 'ca' | 'es';
}

const { lang = 'ca' } = Astro.props;
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;

const navItems = [
  { href: getLocalizedPath('cliente', lang), label: 'Dashboard', icon: 'squares-four', exact: true },
  { href: getLocalizedPath('cliente/alquileres', lang), label: t('cliente.sidebar.alquileres'), icon: 'package' },
  { href: getLocalizedPath('cliente/programar', lang), label: t('cliente.sidebar.programar'), icon: 'calendar-check' },
  { href: getLocalizedPath('cliente/perfil', lang), label: t('cliente.sidebar.perfil'), icon: 'user' },
];

function isActive(href: string, exact: boolean = false) {
  if (exact) {
    return currentPath === href || currentPath === href + '/';
  }
  return currentPath.startsWith(href);
}
---

<!-- Desktop Sidebar -->
<aside class="w-64 flex-shrink-0 hidden lg:block">
  <div class="card p-4 sticky top-24">
    <!-- User Info -->
    <div class="flex items-center gap-3 p-4 mb-4 bg-[var(--color-cream)] rounded-[var(--radius-button)]">
      <div class="w-10 h-10 rounded-full bg-[var(--color-brown-primary)] text-white flex items-center justify-center font-semibold">
        MG
      </div>
      <div>
        <p class="font-medium text-sm">María García</p>
        <p class="text-xs text-[var(--color-text-muted)]">CEIP Mediterrani</p>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="space-y-1">
      {navItems.map(item => (
        <a
          href={item.href}
          class:list={[
            'flex items-center gap-3 px-4 py-3 rounded-[34px] transition-colors',
            isActive(item.href, item.exact)
              ? 'nav-item-active'
              : 'nav-item-inactive'
          ]}
        >
          <i class={`ph ph-${item.icon} text-xl`}></i>
          <span class="font-medium">{item.label}</span>
        </a>
      ))}
    </nav>

    <!-- Quick Actions -->
    <div class="mt-6 pt-6 border-t border-[var(--color-brown-primary)]/10">
      <a
        href={getLocalizedPath('catalogo', lang)}
        class="flex items-center gap-3 px-4 py-3 rounded-[34px] text-[var(--color-text-secondary)] hover:bg-[var(--color-cream)] hover:text-[var(--color-text-primary)] transition-colors"
      >
        <i class="ph ph-plus-circle text-xl"></i>
        <span class="font-medium">{t('client.newOrder')}</span>
      </a>
      <button
        class="w-full flex items-center gap-3 px-4 py-3 rounded-[34px] text-[var(--color-text-muted)] hover:bg-[var(--color-cream)] hover:text-[var(--color-text-primary)] transition-colors"
      >
        <i class="ph ph-sign-out text-xl"></i>
        <span class="font-medium">{t('cliente.sidebar.cerrar')}</span>
      </button>
    </div>
  </div>
</aside>

<!-- Mobile Navigation -->
<div class="lg:hidden mb-6 w-full">
  <div class="card p-2 flex overflow-x-auto gap-2 no-scrollbar">
    {navItems.map(item => (
      <a
        href={item.href}
        class:list={[
          'flex items-center gap-2 px-4 py-2 rounded-[34px] whitespace-nowrap transition-colors flex-shrink-0',
          isActive(item.href, item.exact)
            ? 'nav-item-active'
            : 'nav-item-inactive'
        ]}
      >
        <i class={`ph ph-${item.icon}`}></i>
        <span class="text-sm font-medium">{item.label}</span>
      </a>
    ))}
  </div>
</div>

<style>
  .nav-item-active {
    background-color: var(--color-brown-primary);
    color: white !important;
  }

  .nav-item-active i,
  .nav-item-active span {
    color: white !important;
  }

  .nav-item-inactive {
    color: var(--color-text-secondary);
  }

  .nav-item-inactive:hover {
    background-color: var(--color-cream);
    color: var(--color-text-primary);
  }

  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }

  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
</style>
